<!DOCTYPE html>
<html lang="en">
<head>
    <title>Shop Build</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="assets/logo-shop-build.png">
    <link rel="stylesheet" href="css/navbar.css">
    <link rel="stylesheet" href="css/leftBar.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/navbarAfterLogin.css">
    <link rel="stylesheet" href="css/detailProduct.css">
</head>
<body>
   
    <nav class="navbar navbar-after-login">
        <div >
            <a href="index.html" class="logo-navbar">
                <img src="assets/logo-shop-build.png" alt="">
                Shop Build
            </a>
        </div>
        <div class="icon-responsive-container" onclick="leftBarFunction()">
            <img class="icon-responsive" src="assets/icon-responsive.svg" alt="">
        </div>
        <div class="profile noselect" onclick="toogleDropdown()">
            <img src="assets/profile.png" class="profile-image" alt="">
            <b id="profileName"></b>
            <img src="assets/down-arrow.svg" class="profile-arrow" alt="">
        </div>
        <span class="dropdown hidden noselect" id="dropdownAfterLogin">
            <a href="">Edit Profile</a>
            <a onclick="logOut()">Log Out</a>
        </span>
    </nav>

    <div class="leftBar">
        <a href="dashboard.html"> <img src="assets/dashboard.svg" alt=""> Dashboard</a>
        <a href="listProduct.html"> <img src="assets/darfat-product.svg" alt=""> List Product</a>
        <a href="productSold.html"> <img src="assets/Product-Sold.svg" alt=""> Product Sold</a>
        <a class="active-page" href="editProfile.html"> <img src="assets/Profile.svg" alt=""> Edit Profile</a>
        <a href="" onclick="logOut()"> <img src="assets/Sign_out.svg" alt=""> Log Out</a>
    </div>

    <main>
        <header><img onclick="goToListProduct()" src="assets/backDetail.svg" alt=""><h1>Edit Profile</h1></header>
        <form class="container-detail-product" onsubmit="return false">
            <p class="error-massage hidden oneCol" id="errorSubmit"></p>
           <label for="">Name :</label>
           <input type="text" id="name" onfocus="focuss()">
            <label for="">Address</label>
            <textarea name="" id="address" rows="3" ></textarea>
           <label for="">Email :</label>
           <input type="text" id="email" onfocus="focuss()">
           <label for="">DOB :</label>
           <input type="date" id="DOB" onfocus="focuss()">
           <label for="">Password :</label>
           <input type="password" id="password" >
           <label for="">Phone Number :</label>
           <input type="text" id="pn" >
           <label for="">Last Login :</label>
           <input type="date" id="lastLogin" readonly>
           <div class="container-button">
                <button onclick="goToListProduct()">Cancel</button>
                <button type="submit" id="submitButton" onclick="submitEdit()">Submit</button>
           </div>
        </form>
    </main>


    <script>
        page='detailProduct';
        login='after';

    </script>

    <script src="js/navbar.js"></script>
    <script src="js/source.js"></script>
    <script src="js/checkLogin.js"></script>
    <script>checkLogin()</script>

    <script>
        dataUser = {};

        user.forEach(data => {
            if(data.id === parseInt(localStorage.idUser)){
                dataUser = data;
            }
        });
        space = dataUser.name.indexOf(' ');
        document.getElementById('profileName').innerHTML = dataUser.name.substring(0 , space);

       
        document.getElementById('name').value = dataUser.name;
        document.getElementById('address').value = dataUser.address;
        document.getElementById('email').value = dataUser.email;
        document.getElementById('DOB').value = dataUser.DOB;
        document.getElementById('pn').value = dataUser.phoneNumber;
        document.getElementById('lastLogin').value = dataUser.lastLogin;
        
        function goToListProduct(){
            document.location.href = 'dashboard.html';
        }        

        function validation(){
            if(document.getElementById('name').value === "" || document.getElementById("address").value  === "" || document.getElementById("email").value  === "" || document.getElementById("DOB").value  === "" || document.getElementById("pn").value === "" || document.getElementById("lastLogin").value  === "" ){
                document.getElementById('errorSubmit').classList.remove('hidden');
                document.getElementById('errorSubmit').innerHTML = 'Pastikan Seluruh Field sudah terisi!';
                return false;
            }else{
                return true;
            }
        }

        function focuss(){
            document.getElementById('errorSubmit').classList.add('hidden');
        }


        function submitEdit(){
            
            valid = validation();

            if(valid === true){
                
                password = '';

                if(password === ""){
                    password = dataUser.password
                }else{
                    password = document.getElementById('password')
                }

                dataAfterEdit = {
                    id: parseInt(dataUser.id),
                    name: document.getElementById('name').value,
                    address: document.getElementById('address').value,
                    email: document.getElementById('email').value,
                    DOB: document.getElementById('DOB').value,
                    password: password,
                    phoneNumber: document.getElementById('pn').value,
                    lastLogin: dataUser.lastLogin
                };
                
                dataUserAfterAdd = [];

                user.forEach(data => {
                    dataUserAfterAdd.push(dataAfterEdit);
                });

                dataUserAfterAdd.push(dataAfterEdit);

                localStorage.setItem('user', JSON.stringify(dataUserAfterAdd));
                user.push(dataUserAfterAdd);
                goToListProduct();
            }
        }

    </script>
</body>
</html>
