<!DOCTYPE html>
<html lang="en">
<head>
    <title>Shop Build</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="assets/logo-shop-build.png">
    <link rel="stylesheet" href="css/navbar.css">
    <link rel="stylesheet" href="css/leftBar.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/navbarAfterLogin.css">
    <link rel="stylesheet" href="css/detailProduct.css">
</head>
<body>
   
    <nav class="navbar navbar-after-login">
        <div >
            <a href="index.html" class="logo-navbar">
                <img src="assets/logo-shop-build.png" alt="">
                Shop Build
            </a>
        </div>
        <div class="profile noselect" onclick="toogleDropdown()">
            <img src="assets/profile.png" class="profile-image" alt="">
            <b id="profileName"></b>
            <img src="assets/down-arrow.svg" class="profile-arrow" alt="">
        </div>
        <span class="dropdown hidden noselect" id="dropdownAfterLogin">
            <a href="">Edit Profile</a>
            <a onclick="logOut()">Log Out</a>
        </span>
    </nav>

    <div class="leftBar">
        <a href="dashboard.html"> <img src="assets/dashboard.svg" alt=""> Dashboard</a>
        <a href="listProduct.html"> <img src="assets/darfat-product.svg" alt=""> List Product</a>
        <a href="productSold.html"> <img src="assets/Product-Sold.svg" alt=""> Product Sold</a>
        <a href="editProfile.html"> <img src="assets/Profile.svg" alt=""> Edit Profile</a>
        <a href="" onclick="logOut()"> <img src="assets/Sign_out.svg" alt=""> Log Out</a>
    </div>

    <main>
        <header><img onclick="goToListProduct()" src="assets/backDetail.svg" alt=""><h1>Detail Product</h1></header>
        <form class="container-detail-product" action="listProduct.html" >

            <label for="">Photo</label>
            <input type="file" value="Masjoko.png" name="" id="urlImage">

           <label for="">ID :</label>
           <input type="number" id="id" readonly>

           <label for="">Name Customer :</label>
           <input type="text" id="name">

           <label for="">Product :</label>
           <select name="products" id="products">

          </select>

           <label for="">Qty :</label>
           <input type="number" id="qty">

           <label for="">Total Transaction :</label>
           <input type="text" id="createdBy" readonly>

           <label for="">Date :</label>
           <input type="text" id="date" readonly>

           <div class="container-button">
                <button onclick="goToListProduct()">Cancel</button>
                <button type="submit" id="submitButton" onclick="submitEdit()">Submit</button>
           </div>
        </form>
    </main>


    <script>
        page='detailProduct';
        login='after';

    </script>

    <script src="js/navbar.js"></script>
    <script src="js/source.js"></script>
    <script src="js/checkLogin.js"></script>
    <script>checkLogin()</script>

    <script>
        dataUser = {};

        user.forEach(data => {
            if(data.id === parseInt(localStorage.idUser)){
                dataUser = data;
            }
        });
        space = dataUser.name.indexOf(' ');
        document.getElementById('profileName').innerHTML = dataUser.name.substring(0 , space);

        idProductSold = localStorage.getItem('detailProductSoldId');

        dataProductSold = {};

        productSold.forEach((data , index) => {
            if(parseInt(data.id) === parseInt(idProductSold)){
                dataProductSold = data
            }
        });

        dataProduct = {};

        // product.forEach((data , index) => {
        //     document.getElementById('products').innerHTML = `
        //         <option value="${data.name}">${data.name}</option>
        //     `;
            
        //     if(data.id === parseInt(idProductSold)){
        //         dataProduct = data
        //     }
        // });

        document.getElementById('products').innerHTML = `
            ${product.forEach(data=>{
                    `<option value="${data.name}">${data.name}</option>`
                })}
            `;

        document.getElementById('id').value = idProductSold;
        document.getElementById('name').value = dataProductSold.customerName
        document.getElementById('price').value = dataProduct.price;
        document.getElementById('stock').value = dataProduct.stock;
        document.getElementById('createdBy').value = dataProduct.createdBy;
        document.getElementById('createdDate').value = dataProduct.createdDate;
        
        function goToListProduct(){
            document.location.href = 'listProduct.html'
        }        

        function submitEdit(){
            
            src = dataProduct.photo

            if(document.getElementById('urlImage').value !== ""){
                lastIndex = document.getElementById('urlImage').value.lastIndexOf("\\");
                src = "assets/foto new product/" + document.getElementById('urlImage').value.substring(lastIndex+1);
            }

            dataAfterEdit = {
                id: parseInt(localStorage.getItem("detailProductId")),
                name: document.getElementById('name').value,
                price: document.getElementById('price').value,
                stock: document.getElementById('stock').value,
                photo: src,
                createdBy: parseInt(document.getElementById('createdBy').value),
                createdDate: document.getElementById('createdDate').value
            };
            
            productEdit = [];

            product.forEach(data => {
                if(data.id === parseInt(localStorage.getItem("detailProductId"))){
                    productEdit.push(dataAfterEdit);
                }else{
                    productEdit.push(data);
                }
            });

            localStorage.setItem('product', JSON.stringify(productEdit));
            product = productEdit
            goToListProduct();
        }

    </script>
</body>
</html>
